var f=Object.create;var i=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var o=(e,s)=>i(e,"name",{value:s,configurable:!0});var R=(e,s)=>{for(var t in s)i(e,t,{get:s[t],enumerable:!0})},l=(e,s,t,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of I(s))!S.call(e,r)&&r!==t&&i(e,r,{get:()=>s[r],enumerable:!(n=m(s,r))||n.enumerable});return e};var h=(e,s,t)=>(t=e!=null?f(p(e)):{},l(s||!e||!e.__esModule?i(t,"default",{value:e,enumerable:!0}):t,e)),y=e=>l(i({},"__esModule",{value:!0}),e);var $={};R($,{CarwingsAuthenticator:()=>x,api:()=>g,batteryChargingRequest:()=>E,batteryRecords:()=>F,batteryStatusCheck:()=>O,batteryStatusCheckRequest:()=>N,hvacOff:()=>j,hvacOn:()=>G,hvacStatus:()=>T,loginSession:()=>C});module.exports=y($);var w=require("crypto"),a=h(require("lodash/fp"),1),u=h(require("axios"),1);u.default.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",u.default.defaults.baseURL="https://gdcportalgw.its-mo.com",process.on("unhandledRejection",e=>console.log(e));const d="geORNtsZe5I4lRGjG9GZiA",v="NNA",D="en-US",K="America/Denver",M=o(e=>a.thru(s=>(console.log(e,s),s)),"tlog");class x{static{o(this,"CarwingsAuthenticator")}constructor(s,t,n){const r=/^(?:[A-Z0-9+\/]{4})*(?:[A-Z0-9+\/]{2}==|[A-Z0-9+\/]{3}=|[A-Z0-9+\/]{4})$/i;this.username=s,this.password=t,this.regionCode=n}async login(){return await C(this.username,this.password,this.regionCode)}async validateSession(s,t=!0){let n=s;return typeof n!="function"&&(t=!1),t||(n=await this.login()),n}}function b(e=0){return new Promise(s=>setTimeout(s,e))}o(b,"sleep");async function g(e,s){const t=new URLSearchParams(s);console.log("API",e),console.log("Params",t.toString());const n=await u.default.post(`/gworchest_160803EC/gdc/${e}.php`,t.toString());if(n.data.status===200)return n.data;if(n.data&&n.data.status===401)return n.data;throw new Error(n.data.ErrorMessage)}o(g,"api");const A=a.curry((e,s)=>{const t=(0,w.createCipheriv)("bf-ecb",e,"");let n=t.update(s,"utf8","base64");return n+=t.final("base64"),n});function q(e){return e&&e.vehicleInfo&&e.vehicleInfo[0]?e.vehicleInfo[0].custom_sessionid:e&&e.VehicleInfoList&&e.VehicleInfoList.vehicleInfo[0]?e.VehicleInfoList.vehicleInfo[0].custom_sessionid:null}o(q,"getsessionid");function L(e){return e&&e.vehicleInfo&&e.vehicleInfo[0]?e.vehicleInfo[0].vin:e&&e.VehicleInfoList&&e.VehicleInfoList.vehicleInfo[0]?e.VehicleInfoList.vehicleInfo[0].vin:null}o(L,"getvin");function P(e){return e.CustomerInfo.RegionCode}o(P,"getregioncode");const c=o((e,...s)=>s.length?async(...t)=>e(await c(...s)(...t)):e,"acompose"),V=c(e=>e.baseprm,()=>g("InitialApp",{initial_app_strings:d})),_=o(async(e,s,t=v)=>a.compose(n=>({UserId:e,Password:n,RegionCode:t}),A(await V()))(s),"generateCredentials"),k=o(async e=>await g("UserLoginRequest",{initial_app_strings:d,...e}),"performUserLogin"),Z=c(k,_),C=c(e=>async s=>await g(s,{...e}),e=>({custom_sessionid:q(e),VIN:L(e),RegionCode:P(e)}),Z),B=a.curry(async(e,s,t)=>{let n;do await b(5e3),n=await e(s,{resultKey:t});while(n.responseFlag!=="1");return n}),U=a.curry(async(e,s,t)=>await c(B(t,s),r=>r.resultKey,()=>t(e))()),F=o(e=>e("BatteryStatusRecordsRequest"),"batteryRecords"),N=o(e=>e("BatteryStatusCheckRequest"),"batteryStatusCheckRequest"),O=o(e=>U("BatteryStatusCheckRequest","BatteryStatusCheckResultRequest",e),"batteryStatusCheck"),E=o(e=>e("BatteryRemoteChargingRequest"),"batteryChargingRequest"),G=o(e=>e("ACRemoteRequest"),"hvacOn"),j=o(e=>e("ACRemoteOffRequest"),"hvacOff"),T=o(e=>e("RemoteACRecordsRequest"),"hvacStatus");0&&(module.exports={CarwingsAuthenticator,api,batteryChargingRequest,batteryRecords,batteryStatusCheck,batteryStatusCheckRequest,hvacOff,hvacOn,hvacStatus,loginSession});
//# sourceMappingURL=index.js.map
