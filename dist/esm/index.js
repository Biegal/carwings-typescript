var l=Object.defineProperty;var o=(e,s)=>l(e,"name",{value:s,configurable:!0});import{createCipheriv as h}from"crypto";import*as r from"lodash/fp";import a from"axios";a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",a.defaults.baseURL="https://gdcportalgw.its-mo.com",process.on("unhandledRejection",e=>console.log(e));const g="geORNtsZe5I4lRGjG9GZiA",d="NNA",P="en-US",V="America/Denver",_=o(e=>r.thru(s=>(console.log(e,s),s)),"tlog");class k{static{o(this,"CarwingsAuthenticator")}constructor(s,n,t){const u=/^(?:[A-Z0-9+\/]{4})*(?:[A-Z0-9+\/]{2}==|[A-Z0-9+\/]{3}=|[A-Z0-9+\/]{4})$/i;this.username=s,this.password=n,this.regionCode=t}async login(){return await v(this.username,this.password,this.regionCode)}async validateSession(s,n=!0){let t=s;return typeof t!="function"&&(n=!1),n||(t=await this.login()),t}}function w(e=0){return new Promise(s=>setTimeout(s,e))}o(w,"sleep");async function c(e,s){const n=new URLSearchParams(s);console.log("API",e),console.log("Params",n.toString());const t=await a.post(`/gworchest_160803EC/gdc/${e}.php`,n.toString());if(t.data.status===200)return t.data;if(t.data&&t.data.status===401)return t.data;throw new Error(t.data.ErrorMessage)}o(c,"api");const C=r.curry((e,s)=>{const n=h("bf-ecb",e,"");let t=n.update(s,"utf8","base64");return t+=n.final("base64"),t});function f(e){return e&&e.vehicleInfo&&e.vehicleInfo[0]?e.vehicleInfo[0].custom_sessionid:e&&e.VehicleInfoList&&e.VehicleInfoList.vehicleInfo[0]?e.VehicleInfoList.vehicleInfo[0].custom_sessionid:null}o(f,"getsessionid");function m(e){return e&&e.vehicleInfo&&e.vehicleInfo[0]?e.vehicleInfo[0].vin:e&&e.VehicleInfoList&&e.VehicleInfoList.vehicleInfo[0]?e.VehicleInfoList.vehicleInfo[0].vin:null}o(m,"getvin");function I(e){return e.CustomerInfo.RegionCode}o(I,"getregioncode");const i=o((e,...s)=>s.length?async(...n)=>e(await i(...s)(...n)):e,"acompose"),p=i(e=>e.baseprm,()=>c("InitialApp",{initial_app_strings:g})),S=o(async(e,s,n=d)=>r.compose(t=>({UserId:e,Password:t,RegionCode:n}),C(await p()))(s),"generateCredentials"),R=o(async e=>await c("UserLoginRequest",{initial_app_strings:g,...e}),"performUserLogin"),y=i(R,S),v=i(e=>async s=>await c(s,{...e}),e=>({custom_sessionid:f(e),VIN:m(e),RegionCode:I(e)}),y),x=r.curry(async(e,s,n)=>{let t;do await w(5e3),t=await e(s,{resultKey:n});while(t.responseFlag!=="1");return t}),b=r.curry(async(e,s,n)=>await i(x(n,s),u=>u.resultKey,()=>n(e))()),Z=o(e=>e("BatteryStatusRecordsRequest"),"batteryRecords"),B=o(e=>e("BatteryStatusCheckRequest"),"batteryStatusCheckRequest"),U=o(e=>b("BatteryStatusCheckRequest","BatteryStatusCheckResultRequest",e),"batteryStatusCheck"),F=o(e=>e("BatteryRemoteChargingRequest"),"batteryChargingRequest"),N=o(e=>e("ACRemoteRequest"),"hvacOn"),O=o(e=>e("ACRemoteOffRequest"),"hvacOff"),E=o(e=>e("RemoteACRecordsRequest"),"hvacStatus");export{k as CarwingsAuthenticator,c as api,F as batteryChargingRequest,Z as batteryRecords,U as batteryStatusCheck,B as batteryStatusCheckRequest,O as hvacOff,N as hvacOn,E as hvacStatus,v as loginSession};
//# sourceMappingURL=index.js.map
